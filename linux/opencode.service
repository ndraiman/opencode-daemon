[Unit]
Description=OpenCode Server
After=network-online.target
Wants=network-online.target

[Service]
# Adjust if you prefer a dedicated user.
User=opencode
Group=opencode
WorkingDirectory=/home/opencode

# systemd credential injection
LoadCredential=opencode_password:/etc/opencode/server_password

ExecStart=/bin/sh -lc 'export OPENCODE_SERVER_PASSWORD="$(cat "$CREDENTIALS_DIRECTORY/opencode_password")"; exec /usr/local/bin/opencode serve --hostname 0.0.0.0 --port 4096'

Restart=on-failure
RestartSec=2

# Optional hardening
NoNewPrivileges=true
PrivateTmp=true
ProtectSystem=strict
ProtectHome=true
ReadWritePaths=/home/opencode

[Install]
WantedBy=multi-user.target
